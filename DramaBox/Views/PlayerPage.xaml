<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="DramaBox.Views.PlayerPage"
    x:Name="Page"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:shapes="clr-namespace:Microsoft.Maui.Controls.Shapes;assembly=Microsoft.Maui.Controls"
    Shell.NavBarIsVisible="False"
    Shell.TabBarIsVisible="False"
    NavigationPage.HasNavigationBar="False"
    BackgroundColor="Black">

    <Grid>

        <!-- Área "clicável" (tap = pausa/play) -->
        <Grid x:Name="TapLayer">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnVideoTapped" />
            </Grid.GestureRecognizers>

            <!-- Vídeo -->
            <toolkit:MediaElement x:Name="Player"
                                  ShouldAutoPlay="True"
                                  ShouldShowPlaybackControls="False"
                                  Aspect="AspectFit"
                                  HorizontalOptions="Fill"
                                  VerticalOptions="Fill"
                                  MediaEnded="OnMediaEnded" />
        </Grid>

        <!-- Top gradient -->
        <Grid VerticalOptions="Start"
              HeightRequest="140"
              InputTransparent="True">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#CC000000" Offset="0" />
                    <GradientStop Color="#5A000000" Offset="0.45" />
                    <GradientStop Color="#00000000" Offset="1" />
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <!-- Bottom gradient -->
        <Grid VerticalOptions="End"
              HeightRequest="190"
              InputTransparent="True">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                    <GradientStop Color="#D1000000" Offset="0" />
                    <GradientStop Color="#52000000" Offset="0.55" />
                    <GradientStop Color="#00000000" Offset="1" />
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <!-- Topbar -->
        <Grid Padding="14"
              ColumnDefinitions="Auto,*,Auto"
              VerticalOptions="Start">

            <Border Stroke="#26FFFFFF"
                    StrokeThickness="1"
                    BackgroundColor="#26000000"
                    WidthRequest="48"
                    HeightRequest="48">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>

                <Button Text="←"
                        Clicked="OnBackClicked"
                        BackgroundColor="Transparent"
                        TextColor="#cccccc"
                        FontSize="18"
                        FontAttributes="Bold"/>
            </Border>

            <VerticalStackLayout Grid.Column="1"
                                 Spacing="2"
                                 Margin="12,2,12,0"
                                 VerticalOptions="Center">
                <Label Text="Assistindo"
                       FontSize="12"
                       FontAttributes="Bold"
                       TextColor="#E5E7EB"
                       Opacity="0.92"/>

                <Label Text="{Binding Source={x:Reference Page}, Path=Title}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="White"
                       LineBreakMode="TailTruncation"/>
            </VerticalStackLayout>

            <Border Grid.Column="2"
                    Stroke="#26FFFFFF"
                    StrokeThickness="1"
                    BackgroundColor="#26000000"
                    WidthRequest="48"
                    HeightRequest="48"
                    Opacity="0.9">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>

                <Label Text="⋯"
                       FontSize="22"
                       TextColor="#E5E7EB"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"/>
            </Border>
        </Grid>

        <!-- Overlay: ações (aparecem SOMENTE pausado) -->
        <Grid x:Name="OverlayControls"
              IsVisible="False"
              Opacity="1"
              Padding="14">

            <!-- Botões na direita -->
            <VerticalStackLayout x:Name="RightActions"
                                 HorizontalOptions="End"
                                 VerticalOptions="Center"
                                 Spacing="14">

                <!-- LIKE -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#26000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnLikeClicked"/>
                        <shapes:Path
                            WidthRequest="22"
                            HeightRequest="22"
                            Fill="#E5E7EB"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Data="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402"/>
                    </Grid>
                </Border>

                <!-- SHARE -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#26000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnShareClicked"/>
                        <shapes:Path
                            WidthRequest="22"
                            HeightRequest="22"
                            Fill="#E5E7EB"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Data="M16.272 5.451c-.176-.45-.272-.939-.272-1.451 0-2.208 1.792-4 4-4s4 1.792 4 4-1.792 4-4 4c-1.339 0-2.525-.659-3.251-1.67l-7.131 3.751c.246.591.382 1.239.382 1.919 0 .681-.136 1.33-.384 1.922l7.131 3.751c.726-1.013 1.913-1.673 3.253-1.673 2.208 0 4 1.792 4 4s-1.792 4-4 4-4-1.792-4-4c0-.51.096-.999.27-1.447l-7.129-3.751c-.9 1.326-2.419 2.198-4.141 2.198-2.76 0-5-2.24-5-5s2.24-5 5-5c1.723 0 3.243.873 4.143 2.201l7.129-3.75z"/>
                    </Grid>
                </Border>

                <!-- ADD (playlist/biblioteca) -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#26000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnAddClicked"/>
                        <Label Text="+"
                               FontSize="24"
                               FontAttributes="Bold"
                               TextColor="#E5E7EB"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"/>
                    </Grid>
                </Border>

                <!-- PRÓXIMO -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#26000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnNextClicked"/>
                        <Label Text="⏭"
                               FontSize="18"
                               TextColor="#E5E7EB"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"/>
                    </Grid>
                </Border>

            </VerticalStackLayout>

            <!-- Indicador central de play (opcional) -->
            <Border HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Stroke="#26FFFFFF"
                    StrokeThickness="1"
                    BackgroundColor="#26000000"
                    WidthRequest="86"
                    HeightRequest="86">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="26"/>
                </Border.StrokeShape>
                <Label Text="▶"
                       FontSize="30"
                       TextColor="#E5E7EB"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"/>
            </Border>

        </Grid>

    </Grid>
</ContentPage>