<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="DramaBox.Views.PlayerPage"
    x:Name="Page"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    Shell.NavBarIsVisible="False"
    Shell.TabBarIsVisible="False"
    NavigationPage.HasNavigationBar="False"
    BackgroundColor="Black">

    <Grid>

        <!-- Área "clicável" (tap = pausa/play) + swipe up = próximo -->
        <Grid x:Name="TapLayer">
            <Grid.GestureRecognizers>
                <TapGestureRecognizer Tapped="OnVideoTapped" />

                <!-- Swipe vertical (up = próximo) -->
                <PanGestureRecognizer PanUpdated="OnPanUpdated" />
            </Grid.GestureRecognizers>

            <!-- Vídeo -->
            <toolkit:MediaElement x:Name="Player"
                                  ShouldAutoPlay="True"
                                  ShouldShowPlaybackControls="False"
                                  Aspect="AspectFit"
                                  HorizontalOptions="Fill"
                                  VerticalOptions="Fill"
                                  MediaEnded="OnMediaEnded" />
        </Grid>

        <!-- Top gradient -->
        <Grid VerticalOptions="Start"
              HeightRequest="140"
              InputTransparent="True">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="0,1">
                    <GradientStop Color="#CC000000" Offset="0" />
                    <GradientStop Color="#5A000000" Offset="0.45" />
                    <GradientStop Color="#00000000" Offset="1" />
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <!-- Bottom gradient -->
        <Grid VerticalOptions="End"
              HeightRequest="190"
              InputTransparent="True">
            <Grid.Background>
                <LinearGradientBrush StartPoint="0,1" EndPoint="0,0">
                    <GradientStop Color="#D1000000" Offset="0" />
                    <GradientStop Color="#52000000" Offset="0.55" />
                    <GradientStop Color="#00000000" Offset="1" />
                </LinearGradientBrush>
            </Grid.Background>
        </Grid>

        <!-- Topbar -->
        <Grid Padding="14"
              ColumnDefinitions="Auto,*,Auto"
              VerticalOptions="Start">

            <Border Stroke="#26FFFFFF"
                    StrokeThickness="1"
                    BackgroundColor="#55000000"
                    WidthRequest="48"
                    HeightRequest="48">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>

                <!-- backwhite.png -->
                <ImageButton Source="backwhite.png"
                             BackgroundColor="Transparent"
                             WidthRequest="48"
                             HeightRequest="48"
                             Padding="12"
                             Clicked="OnBackClicked"/>
            </Border>

            <VerticalStackLayout Grid.Column="1"
                                 Spacing="2"
                                 Margin="12,2,12,0"
                                 VerticalOptions="Center">
                <Label Text="Assistindo"
                       FontSize="12"
                       FontAttributes="Bold"
                       TextColor="#E5E7EB"
                       Opacity="0.92"/>

                <Label Text="{Binding Source={x:Reference Page}, Path=Title}"
                       FontSize="16"
                       FontAttributes="Bold"
                       TextColor="White"
                       LineBreakMode="TailTruncation"/>
            </VerticalStackLayout>

            <Border Grid.Column="2"
                    Stroke="#26FFFFFF"
                    StrokeThickness="1"
                    BackgroundColor="#55000000"
                    WidthRequest="48"
                    HeightRequest="48"
                    Opacity="0.9">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="16"/>
                </Border.StrokeShape>

                <Label Text="⋯"
                       FontSize="22"
                       TextColor="#E5E7EB"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"/>
            </Border>
        </Grid>

        <!-- Overlay: ações (aparecem SOMENTE pausado) -->
        <Grid x:Name="OverlayControls"
              IsVisible="False"
              Opacity="1"
              Padding="14">

            <!-- Botões na direita -->
            <VerticalStackLayout x:Name="RightActions"
                                 HorizontalOptions="End"
                                 VerticalOptions="Center"
                                 Spacing="14">

                <!-- LIKE (likewhite.png) -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#55000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnLikeClicked"/>
                        <Image Source="likewhite.png"
                               WidthRequest="22"
                               HeightRequest="22"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               InputTransparent="True"/>
                    </Grid>
                </Border>

                <!-- SHARE (sharewhite.png) -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#55000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnShareClicked"/>
                        <Image Source="sharewhite.png"
                               WidthRequest="22"
                               HeightRequest="22"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               InputTransparent="True"/>
                    </Grid>
                </Border>

                <!-- ADD (pluswhite.png) -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#55000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnAddClicked"/>
                        <Image Source="pluswhite.png"
                               WidthRequest="22"
                               HeightRequest="22"
                               HorizontalOptions="Center"
                               VerticalOptions="Center"
                               InputTransparent="True"/>
                    </Grid>
                </Border>

                <!-- PRÓXIMO (mantém do jeito que tá) -->
                <Border Stroke="#26FFFFFF"
                        StrokeThickness="1"
                        BackgroundColor="#55000000"
                        WidthRequest="56"
                        HeightRequest="56">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="16"/>
                    </Border.StrokeShape>
                    <Grid>
                        <Button BackgroundColor="Transparent"
                                Clicked="OnNextClicked"/>
                        <Label Text="⏭"
                               FontSize="18"
                               TextColor="#E5E7EB"
                               HorizontalTextAlignment="Center"
                               VerticalTextAlignment="Center"
                               InputTransparent="True"/>
                    </Grid>
                </Border>

            </VerticalStackLayout>

            <!-- Indicador central de play (opcional) -->
            <Border HorizontalOptions="Center"
                    VerticalOptions="Center"
                    Stroke="#26FFFFFF"
                    StrokeThickness="1"
                    BackgroundColor="#55000000"
                    WidthRequest="86"
                    HeightRequest="86">
                <Border.StrokeShape>
                    <RoundRectangle CornerRadius="26"/>
                </Border.StrokeShape>
                <Label Text="▶"
                       FontSize="30"
                       TextColor="#E5E7EB"
                       HorizontalTextAlignment="Center"
                       VerticalTextAlignment="Center"/>
            </Border>

        </Grid>

    </Grid>
</ContentPage>