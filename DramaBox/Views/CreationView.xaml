<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="DramaBox.Views.CreationView"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Shell.NavBarIsVisible="False"
    NavigationPage.HasNavigationBar="False"
    NavigationPage.HasBackButton="False">

    <Grid Padding="18" RowSpacing="14">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Topo -->
        <Grid Grid.Row="0" ColumnDefinitions="*,Auto" VerticalOptions="Center">
            <Label Text="Área do Criador"
                   Style="{StaticResource TitleLargeLabelStyle}" />

            <Button Grid.Column="1"
                    Text="⟳"
                    BackgroundColor="Transparent"
                    WidthRequest="44"
                    HeightRequest="44"
                    CornerRadius="14"
                    Clicked="OnRefreshClicked"/>
        </Grid>

        <!-- Dashboard -->
        <Border Grid.Row="1" Style="{StaticResource CardBorderStyle}">
            <VerticalStackLayout Spacing="10">

                <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                    <Label Text="Dashboard"
                           Style="{StaticResource TitleMediumLabelStyle}" />

                    <Border Grid.Column="1" Style="{StaticResource InputContainerStyle}" Padding="10,6">
                        <Label Text="Agora" FontAttributes="Bold" FontSize="12" />
                    </Border>
                </Grid>

                <Label Text="Resumo do seu desempenho como criador."
                       Style="{StaticResource MutedLabelStyle}" />

                <Grid ColumnDefinitions="*,*,*" ColumnSpacing="10">

                    <Border Style="{StaticResource CardBorderStyle}">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Receita" Style="{StaticResource MutedLabelStyle}" FontAttributes="Bold" />
                            <Label x:Name="RevenueLabel" Text="R$ 0,00" FontAttributes="Bold" FontSize="18" />
                            <Label Text="VIP pode sacar futuramente (MVP)"
                                   Style="{StaticResource MutedLabelStyle}" FontSize="12" />
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="1" Style="{StaticResource CardBorderStyle}">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Curtidas" Style="{StaticResource MutedLabelStyle}" FontAttributes="Bold" />
                            <Label x:Name="LikesLabel" Text="0" FontAttributes="Bold" FontSize="18" />
                            <Label Text="Total acumulado" Style="{StaticResource MutedLabelStyle}" FontSize="12" />
                        </VerticalStackLayout>
                    </Border>

                    <Border Grid.Column="2" Style="{StaticResource CardBorderStyle}">
                        <VerticalStackLayout Spacing="6">
                            <Label Text="Shares" Style="{StaticResource MutedLabelStyle}" FontAttributes="Bold" />
                            <Label x:Name="SharesLabel" Text="0" FontAttributes="Bold" FontSize="18" />
                            <Label Text="Total acumulado" Style="{StaticResource MutedLabelStyle}" FontSize="12" />
                        </VerticalStackLayout>
                    </Border>

                </Grid>
            </VerticalStackLayout>
        </Border>

        <!-- Minhas séries -->
        <Grid Grid.Row="2" RowDefinitions="Auto,*" RowSpacing="12">

            <Grid Grid.Row="0" ColumnDefinitions="*,Auto" VerticalOptions="Center">
                <Label Text="Minhas séries"
                       Style="{StaticResource TitleMediumLabelStyle}" />

                <Button Grid.Column="1"
                        Text="+"
                        WidthRequest="44"
                        HeightRequest="44"
                        CornerRadius="14"
                        BackgroundColor="{StaticResource AppPrimaryColor}"
                        TextColor="White"
                        Clicked="OnCreateSeriesClicked"/>
            </Grid>

            <!-- ✅ agora com seleção -->
            <CollectionView Grid.Row="1"
                            x:Name="MySeriesList"
                            ItemsSource="{Binding MySeries}"
                            SelectionMode="Single"
                            SelectionChanged="OnSeriesSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Style="{StaticResource CardBorderStyle}" Padding="12" Margin="0,0,0,12">
                            <Grid ColumnDefinitions="110,*" ColumnSpacing="12">

                                <Border StrokeThickness="0" Padding="0" HeightRequest="70">
                                    <Border.StrokeShape>
                                        <RoundRectangle CornerRadius="14"/>
                                    </Border.StrokeShape>
                                    <Image Source="{Binding CoverUrl}"
                                           Aspect="AspectFill"
                                           HeightRequest="70"
                                           WidthRequest="110"/>
                                </Border>

                                <VerticalStackLayout Grid.Column="1" Spacing="4">
                                    <Label Text="{Binding Title}"
                                           FontAttributes="Bold"
                                           FontSize="14"
                                           LineBreakMode="TailTruncation"/>

                                    <Label Text="{Binding Subtitle}"
                                           FontSize="12"
                                           TextColor="{StaticResource AppMutedTextColor}"
                                           LineBreakMode="TailTruncation"/>

                                    <Grid ColumnDefinitions="*,Auto" Margin="0,6,0,0">
                                        <Label Text="{Binding EpisodesText}"
                                               FontSize="12"
                                               TextColor="{StaticResource AppMutedTextColor}" />

                                        <Button Grid.Column="1"
                                                Text="Gerenciar"
                                                BackgroundColor="Transparent"/>
                                    </Grid>
                                </VerticalStackLayout>

                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </Grid>
    </Grid>
</ContentPage>
